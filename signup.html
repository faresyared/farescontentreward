<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 350px; /* Slightly wider to accommodate new fields */
            text-align: center;
        }
        h2 {
            margin-bottom: 20px;
            color: #333;
        }
        .form-group {
            margin-bottom: 15px;
            text-align: left;
            position: relative; /* For dropdown positioning */
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
        }
        input[type="email"],
        input[type="password"],
        input[type="tel"] {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .phone-input-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .phone-input-group select,
        .phone-input-group input[type="tel"] {
            margin-bottom: 0; /* Remove margin from individual inputs in group */
        }
        .country-code-select {
            width: 100px; /* Fixed width for country code dropdown */
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 10px;
            appearance: none; /* Remove default arrow */
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%20viewBox%3D%220%200%20292.4%20292.4%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M287%20197.97L146.2%2057.17l-140.8%20140.8%2028.3-28.3L146.2%20102.77l112.5%20112.5z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 8px top 50%;
            background-size: 12px auto;
            cursor: pointer;
        }
        .phone-input {
            flex-grow: 1; /* Take remaining space */
        }

        /* Dropdown specific styles */
        .dropdown-container {
            position: relative;
            width: 100%;
        }
        .dropdown-input {
            width: calc(100% - 20px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            text-align: left;
            background-color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .dropdown-input::after {
            content: '▼';
            font-size: 0.8em;
            margin-left: 10px;
            transition: transform 0.2s;
        }
        .dropdown-input.active::after {
            transform: rotate(180deg);
        }
        .dropdown-list {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 100;
            display: none;
            padding: 0;
            margin: 0;
            list-style: none;
        }
        .dropdown-list.active {
            display: block;
        }
        .dropdown-list input[type="text"] { /* Search bar inside dropdown */
            width: calc(100% - 20px);
            padding: 8px;
            margin: 10px;
            border: 1px solid #eee;
            border-radius: 4px;
        }
        .dropdown-list li {
            padding: 10px;
            cursor: pointer;
            text-align: left;
        }
        .dropdown-list li:hover {
            background-color: #f0f0f0;
        }
        .dropdown-list li.hidden {
            display: none;
        }

        /* Role selection */
        .role-selection {
            display: flex;
            justify-content: space-around;
            margin-bottom: 15px;
        }
        .role-selection label {
            display: flex;
            align-items: center;
            cursor: pointer;
            color: #555;
        }
        .role-selection input[type="radio"] {
            margin-right: 8px;
            transform: scale(1.2); /* Make radio buttons slightly larger */
        }
        
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }
        button:hover {
            background-color: #0056b3;
        }
        #message {
            margin-top: 15px;
            font-weight: bold;
            color: red;
        }
        #message.success {
            color: green;
        }
        .link {
            margin-top: 15px;
            font-size: 0.9em;
        }
        .link a {
            color: #007bff;
            text-decoration: none;
        }
        .link a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Sign Up</h2>
        <form id="signUpForm">
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required>
            </div>
            <div class="form-group">
                <label for="confirmPassword">Confirm Password:</label>
                <input type="password" id="confirmPassword" name="confirmPassword" required>
            </div>

            <div class="form-group">
                <label for="phoneNumber">Phone Number:</label>
                <div class="phone-input-group">
                    <div class="dropdown-container" style="width: 120px; margin-right: 10px;">
                        <div class="dropdown-input" id="countryCodeDropdown" data-value="">
                            +1
                        </div>
                        <ul class="dropdown-list" id="countryCodeList">
                            <input type="text" id="countryCodeSearch" placeholder="Search code..." onkeyup="filterDropdown('countryCodeList', this.value)">
                            </ul>
                    </div>
                    <input type="tel" id="phoneNumber" name="phoneNumber" class="phone-input" placeholder="e.g., 555-1234" required>
                </div>
            </div>

            <div class="form-group">
                <label for="country">Country:</label>
                <div class="dropdown-container">
                    <div class="dropdown-input" id="countryDropdown" data-value="">
                        Select Country
                    </div>
                    <ul class="dropdown-list" id="countryList">
                        <input type="text" id="countrySearch" placeholder="Search country..." onkeyup="filterDropdown('countryList', this.value)">
                        </ul>
                </div>
                <input type="hidden" id="country" name="country"> </div>

            <div class="form-group">
                <label>Register as:</label>
                <div class="role-selection">
                    <label>
                        <input type="radio" name="role" value="clipper" required> Clipper
                    </label>
                    <label>
                        <input type="radio" name="role" value="content_creator" required> Content Creator
                    </label>
                </div>
            </div>

            <button type="submit">Sign Up</button>
        </form>
        <p id="message"></p>
        <p class="link">Already have an account? <a href='index.html'>Sign In</a></p>
    </div>

    <script>
        // Data for countries and phone codes
        const countries = [
            { name: "Afghanistan", code: "AF", phone: "93" },
            { name: "Albania", code: "AL", phone: "355" },
            { name: "Algeria", code: "DZ", phone: "213" },
            { name: "Andorra", code: "AD", phone: "376" },
            { name: "Angola", code: "AO", phone: "244" },
            { name: "Antigua and Barbuda", code: "AG", phone: "1-268" },
            { name: "Argentina", code: "AR", phone: "54" },
            { name: "Armenia", code: "AM", phone: "374" },
            { name: "Australia", code: "AU", phone: "61" },
            { name: "Austria", code: "AT", phone: "43" },
            { name: "Azerbaijan", code: "AZ", phone: "994" },
            { name: "Bahamas", code: "BS", phone: "1-242" },
            { name: "Bahrain", code: "BH", phone: "973" },
            { name: "Bangladesh", code: "BD", phone: "880" },
            { name: "Barbados", code: "BB", phone: "1-246" },
            { name: "Belarus", code: "BY", phone: "375" },
            { name: "Belgium", code: "BE", phone: "32" },
            { name: "Belize", code: "BZ", phone: "501" },
            { name: "Benin", code: "BJ", phone: "229" },
            { name: "Bhutan", code: "BT", phone: "975" },
            { name: "Bolivia", code: "BO", phone: "591" },
            { name: "Bosnia and Herzegovina", code: "BA", phone: "387" },
            { name: "Botswana", code: "BW", phone: "267" },
            { name: "Brazil", code: "BR", phone: "55" },
            { name: "Brunei", code: "BN", phone: "673" },
            { name: "Bulgaria", code: "BG", phone: "359" },
            { name: "Burkina Faso", code: "BF", phone: "226" },
            { name: "Burundi", code: "BI", phone: "257" },
            { name: "Cabo Verde", code: "CV", phone: "238" },
            { name: "Cambodia", code: "KH", phone: "855" },
            { name: "Cameroon", code: "CM", phone: "237" },
            { name: "Canada", code: "CA", phone: "1" },
            { name: "Central African Republic", code: "CF", phone: "236" },
            { name: "Chad", code: "TD", phone: "235" },
            { name: "Chile", code: "CL", phone: "56" },
            { name: "China", code: "CN", phone: "86" },
            { name: "Colombia", code: "CO", phone: "57" },
            { name: "Comoros", code: "KM", phone: "269" },
            { name: "Congo (DRC)", code: "CD", phone: "243" },
            { name: "Congo (Republic)", code: "CG", phone: "242" },
            { name: "Costa Rica", code: "CR", phone: "506" },
            { name: "Côte d'Ivoire", code: "CI", phone: "225" },
            { name: "Croatia", code: "HR", phone: "385" },
            { name: "Cuba", code: "CU", phone: "53" },
            { name: "Cyprus", code: "CY", phone: "357" },
            { name: "Czechia", code: "CZ", phone: "420" },
            { name: "Denmark", code: "DK", phone: "45" },
            { name: "Djibouti", code: "DJ", phone: "253" },
            { name: "Dominica", code: "DM", phone: "1-767" },
            { name: "Dominican Republic", code: "DO", phone: "1-809, 1-829, 1-849" },
            { name: "Ecuador", code: "EC", phone: "593" },
            { name: "Egypt", code: "EG", phone: "20" },
            { name: "El Salvador", code: "SV", phone: "503" },
            { name: "Equatorial Guinea", code: "GQ", phone: "240" },
            { name: "Eritrea", code: "ER", phone: "291" },
            { name: "Estonia", code: "EE", phone: "372" },
            { name: "Eswatini", code: "SZ", phone: "268" },
            { name: "Ethiopia", code: "ET", phone: "251" },
            { name: "Fiji", code: "FJ", phone: "679" },
            { name: "Finland", code: "FI", phone: "358" },
            { name: "France", code: "FR", phone: "33" },
            { name: "Gabon", code: "GA", phone: "241" },
            { name: "Gambia", code: "GM", phone: "220" },
            { name: "Georgia", code: "GE", phone: "995" },
            { name: "Germany", code: "DE", phone: "49" },
            { name: "Ghana", code: "GH", phone: "233" },
            { name: "Greece", code: "GR", phone: "30" },
            { name: "Grenada", code: "GD", phone: "1-473" },
            { name: "Guatemala", code: "GT", phone: "502" },
            { name: "Guinea", code: "GN", phone: "224" },
            { name: "Guinea-Bissau", code: "GW", phone: "245" },
            { name: "Guyana", code: "GY", phone: "592" },
            { name: "Haiti", code: "HT", phone: "509" },
            { name: "Honduras", code: "HN", "phone": "504" },
            { name: "Hungary", code: "HU", phone: "36" },
            { name: "Iceland", code: "IS", phone: "354" },
            { name: "India", code: "IN", phone: "91" },
            { name: "Indonesia", code: "ID", phone: "62" },
            { name: "Iran", code: "IR", phone: "98" },
            { name: "Iraq", code: "IQ", phone: "964" },
            { name: "Ireland", code: "IE", phone: "353" },
            { name: "Israel", code: "IL", phone: "972" },
            { name: "Italy", code: "IT", phone: "39" },
            { name: "Jamaica", code: "JM", phone: "1-876" },
            { name: "Japan", code: "JP", phone: "81" },
            { name: "Jordan", code: "JO", phone: "962" },
            { name: "Kazakhstan", code: "KZ", phone: "7" },
            { name: "Kenya", code: "KE", phone: "254" },
            { name: "Kiribati", code: "KI", phone: "686" },
            { name: "Kuwait", code: "KW", phone: "965" },
            { name: "Kyrgyzstan", code: "KG", phone: "996" },
            { name: "Laos", code: "LA", phone: "856" },
            { name: "Latvia", code: "LV", phone: "371" },
            { name: "Lebanon", code: "LB", phone: "961" },
            { name: "Lesotho", code: "LS", phone: "266" },
            { name: "Liberia", code: "LR", phone: "231" },
            { name: "Libya", code: "LY", phone: "218" },
            { name: "Liechtenstein", code: "LI", phone: "423" },
            { name: "Lithuania", code: "LT", phone: "370" },
            { name: "Luxembourg", code: "LU", phone: "352" },
            { name: "Madagascar", code: "MG", phone: "261" },
            { name: "Malawi", code: "MW", phone: "265" },
            { name: "Malaysia", code: "MY", phone: "60" },
            { name: "Maldives", code: "MV", phone: "960" },
            { name: "Mali", code: "ML", phone: "223" },
            { name: "Malta", code: "MT", phone: "356" },
            { name: "Marshall Islands", code: "MH", phone: "692" },
            { name: "Mauritania", code: "MR", phone: "222" },
            { name: "Mauritius", code: "MU", phone: "230" },
            { name: "Mexico", code: "MX", phone: "52" },
            { name: "Micronesia", code: "FM", phone: "691" },
            { name: "Moldova", code: "MD", phone: "373" },
            { name: "Monaco", code: "MC", phone: "377" },
            { name: "Mongolia", code: "MN", phone: "976" },
            { name: "Montenegro", code: "ME", phone: "382" },
            { name: "Morocco", code: "MA", phone: "212" },
            { name: "Mozambique", code: "MZ", phone: "258" },
            { name: "Myanmar", code: "MM", phone: "95" },
            { name: "Namibia", code: "NA", phone: "264" },
            { name: "Nauru", code: "NR", phone: "674" },
            { name: "Nepal", code: "NP", phone: "977" },
            { name: "Netherlands", code: "NL", phone: "31" },
            { name: "New Zealand", code: "NZ", phone: "64" },
            { name: "Nicaragua", code: "NI", phone: "505" },
            { name: "Niger", code: "NE", phone: "227" },
            { name: "Nigeria", code: "NG", phone: "234" },
            { name: "North Korea", code: "KP", phone: "850" },
            { name: "North Macedonia", code: "MK", phone: "389" },
            { name: "Norway", code: "NO", phone: "47" },
            { name: "Oman", code: "OM", phone: "968" },
            { name: "Pakistan", code: "PK", phone: "92" },
            { name: "Palau", code: "PW", phone: "680" },
            { name: "Palestine", code: "PS", phone: "970" },
            { name: "Panama", code: "PA", phone: "507" },
            { name: "Papua New Guinea", code: "PG", phone: "675" },
            { name: "Paraguay", code: "PY", phone: "595" },
            { name: "Peru", code: "PE", phone: "51" },
            { name: "Philippines", code: "PH", phone: "63" },
            { name: "Poland", code: "PL", phone: "48" },
            { name: "Portugal", code: "PT", phone: "351" },
            { name: "Qatar", code: "QA", phone: "974" },
            { name: "Romania", code: "RO", phone: "40" },
            { name: "Russia", code: "RU", phone: "7" },
            { name: "Rwanda", code: "RW", phone: "250" },
            { name: "Saint Kitts and Nevis", code: "KN", phone: "1-869" },
            { name: "Saint Lucia", code: "LC", phone: "1-758" },
            { name: "Saint Vincent and the Grenadines", code: "VC", phone: "1-784" },
            { name: "Samoa", code: "WS", phone: "685" },
            { name: "San Marino", code: "SM", phone: "378" },
            { name: "Sao Tome and Principe", code: "ST", phone: "239" },
            { name: "Saudi Arabia", code: "SA", phone: "966" },
            { name: "Senegal", code: "SN", phone: "221" },
            { name: "Serbia", code: "RS", phone: "381" },
            { name: "Seychelles", code: "SC", phone: "248" },
            { name: "Sierra Leone", code: "SL", phone: "232" },
            { name: "Singapore", code: "SG", phone: "65" },
            { name: "Slovakia", code: "SK", phone: "421" },
            { name: "Slovenia", code: "SI", phone: "386" },
            { name: "Solomon Islands", code: "SB", phone: "677" },
            { name: "Somalia", code: "SO", phone: "252" },
            { name: "South Africa", code: "ZA", phone: "27" },
            { name: "South Korea", code: "KR", phone: "82" },
            { name: "South Sudan", code: "SS", phone: "211" },
            { name: "Spain", code: "ES", phone: "34" },
            { name: "Sri Lanka", code: "LK", phone: "94" },
            { name: "Sudan", code: "SD", phone: "249" },
            { name: "Suriname", code: "SR", phone: "597" },
            { name: "Sweden", code: "SE", phone: "46" },
            { name: "Switzerland", code: "CH", phone: "41" },
            { name: "Syria", code: "SY", phone: "963" },
            { name: "Taiwan", code: "TW", phone: "886" },
            { name: "Tajikistan", code: "TJ", phone: "992" },
            { name: "Tanzania", code: "TZ", phone: "255" },
            { name: "Thailand", code: "TH", phone: "66" },
            { name: "Timor-Leste", code: "TL", phone: "670" },
            { name: "Togo", code: "TG", phone: "228" },
            { name: "Tonga", code: "TO", phone: "676" },
            { name: "Trinidad and Tobago", code: "TT", phone: "1-868" },
            { name: "Tunisia", code: "TN", phone: "216" },
            { name: "Turkey", code: "TR", phone: "90" },
            { name: "Turkmenistan", code: "TM", phone: "993" },
            { name: "Tuvalu", code: "TV", phone: "688" },
            { name: "Uganda", code: "UG", phone: "256" },
            { name: "Ukraine", code: "UA", phone: "380" },
            { name: "United Arab Emirates", code: "AE", phone: "971" },
            { name: "United Kingdom", code: "GB", phone: "44" },
            { name: "United States", code: "US", phone: "1" },
            { name: "Uruguay", code: "UY", phone: "598" },
            { name: "Uzbekistan", code: "UZ", phone: "998" },
            { name: "Vanuatu", code: "VU", phone: "678" },
            { name: "Vatican City", code: "VA", phone: "379" },
            { name: "Venezuela", code: "VE", phone: "58" },
            { name: "Vietnam", code: "VN", phone: "84" },
            { name: "Yemen", code: "YE", phone: "967" },
            { name: "Zambia", code: "ZM", phone: "260" },
            { name: "Zimbabwe", code: "ZW", phone: "263" }
        ];

        // --- Dropdown Logic (for both country code and country) ---
        function setupDropdown(dropdownId, listId, searchId, hiddenInputId, data, formatText) {
            const dropdownInput = document.getElementById(dropdownId);
            const dropdownList = document.getElementById(listId);
            const searchInput = document.getElementById(searchId);
            const hiddenInput = document.getElementById(hiddenInputId);

            // Populate the list
            data.forEach(item => {
                const li = document.createElement('li');
                li.textContent = formatText(item);
                li.setAttribute('data-value', item.value); // Store the actual value to send
                dropdownList.appendChild(li);
            });

            // Toggle dropdown visibility
            dropdownInput.addEventListener('click', () => {
                dropdownList.classList.toggle('active');
                dropdownInput.classList.toggle('active');
                if (dropdownList.classList.contains('active')) {
                    searchInput.focus(); // Focus search bar when dropdown opens
                    filterDropdown(listId, searchInput.value); // Re-filter on open
                }
            });

            // Select an item
            dropdownList.addEventListener('click', (event) => {
                if (event.target.tagName === 'LI') {
                    dropdownInput.textContent = event.target.textContent;
                    dropdownInput.setAttribute('data-value', event.target.getAttribute('data-value'));
                    if (hiddenInput) { // Only set hidden input if it exists (for country, not code)
                        hiddenInput.value = event.target.getAttribute('data-value');
                    }
                    dropdownList.classList.remove('active');
                    dropdownInput.classList.remove('active');
                }
            });

            // Close dropdown if clicked outside
            document.addEventListener('click', (event) => {
                if (!dropdownInput.contains(event.target) && !dropdownList.contains(event.target)) {
                    dropdownList.classList.remove('active');
                    dropdownInput.classList.remove('active');
                }
            });
        }

        // Filter dropdown list items
        function filterDropdown(listId, filter) {
            const ul = document.getElementById(listId);
            const li = ul.getElementsByTagName('li');
            filter = filter.toUpperCase();
            for (let i = 0; i < li.length; i++) {
                const txtValue = li[i].textContent || li[i].innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    li[i].classList.remove('hidden');
                } else {
                    li[i].classList.add('hidden');
                }
            }
        }

        // Initialize dropdowns on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            // Setup Country Code Dropdown
            setupDropdown(
                'countryCodeDropdown',
                'countryCodeList',
                'countryCodeSearch',
                null, // No hidden input needed, value is directly used
                countries.map(c => ({ value: `+${c.phone}`, display: `+${c.phone} (${c.name})` })).sort((a, b) => {
                    // Sort by phone code numerically, then by country name alphabetically
                    const phoneA = parseInt(a.phone?.replace('+', '') || '0');
                    const phoneB = parseInt(b.phone?.replace('+', '') || '0');
                    if (phoneA !== phoneB) {
                        return phoneA - phoneB;
                    }
                    return a.display.localeCompare(b.display);
                }),
                (item) => item.display
            );
            // Set initial selected value for country code
            document.getElementById('countryCodeDropdown').textContent = `+${countries.find(c => c.code === 'US')?.phone || '1'} (${countries.find(c => c.code === 'US')?.name || 'United States'})`;
            document.getElementById('countryCodeDropdown').setAttribute('data-value', `+${countries.find(c => c.code === 'US')?.phone || '1'}`);


            // Setup Country Dropdown
            setupDropdown(
                'countryDropdown',
                'countryList',
                'countrySearch',
                'country', // Link to hidden input 'country'
                countries.map(c => ({ value: c.name, display: c.name })).sort((a, b) => a.display.localeCompare(b.display)),
                (item) => item.display
            );
        });


        // --- Sign Up Form Submission ---
        document.getElementById('signUpForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const countryCode = document.getElementById('countryCodeDropdown').getAttribute('data-value');
            const phoneNumber = document.getElementById('phoneNumber').value;
            const country = document.getElementById('country').value; // Get value from hidden input
            const role = document.querySelector('input[name="role"]:checked'); // Get selected role radio button

            const messageElement = document.getElementById('message');

            if (password !== confirmPassword) {
                messageElement.textContent = 'Passwords do not match.';
                messageElement.className = '';
                return;
            }

            if (!country) {
                messageElement.textContent = 'Please select your country.';
                messageElement.className = '';
                return;
            }

            if (!role) {
                messageElement.textContent = 'Please select if you are a Clipper or Content Creator.';
                messageElement.className = '';
                return;
            }

            messageElement.textContent = 'Signing up...';
            messageElement.className = '';

            try {
                const response = await fetch('/api/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email,
                        password,
                        phoneCode: countryCode,
                        phoneNumber,
                        country,
                        role: role.value // Send the role value
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    messageElement.textContent = result.message;
                    messageElement.className = 'success';
                    document.getElementById('signUpForm').reset(); // Clear the form
                    // Optionally redirect to sign-in page after successful signup
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000); // Redirect after 2 seconds
                } else {
                    messageElement.textContent = result.message || 'An unknown error occurred.';
                    messageElement.className = '';
                }
            } catch (error) {
                messageElement.textContent = 'Network error. Could not connect to server.';
                messageElement.className = '';
                console.error('Fetch error:', error);
            }
        });
    </script>
</body>
</html>
